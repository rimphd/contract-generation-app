{% extends "base.html" %}
{% block content %}
<h1 class="page-title mb-2">Contrat g√©n√©r√©</h1>
<p class="meta mb-3">
  Mod√®le: <span class="model">{{ model_id }}</span> ¬∑ Temp√©rature: {{ temperature }}
</p>

<div class="contract-actions d-flex flex-wrap align-items-center gap-2 mb-3">
  <a class="btn btn-secondary" href="{{ url_for('index') }}">‚Üê Retour</a>
  <button class="btn btn-outline-primary" id="copyBtn">Copier le contrat</button>

  <form method="post" action="{{ url_for('download_docx_no_db') }}" class="m-0">
    <textarea name="contract_text" hidden>{{ contract_text }}</textarea>
    <button class="btn btn-success" type="submit">T√©l√©charger (.docx)</button>
  </form>

  <form method="post" action="{{ url_for('download_pdf_no_db') }}" class="m-0">
    <textarea name="contract_text" hidden>{{ contract_text }}</textarea>
    <button class="btn btn-danger" type="submit">T√©l√©charger (.pdf)</button>
  </form>
</div>
<form method="post" action="{{ url_for('save') }}">
  <!-- contenu du contrat -->
  <textarea name="contract_text" class="d-none">{{ contract_text }}</textarea>

  <!-- m√©tadonn√©es pour la DB -->
  <input type="hidden" name="model_id" value="{{ model_id }}">
  <input type="hidden" name="temperature" value="{{ temperature }}">
  {% for k, v in params.items() %}
    <input type="hidden" name="{{ k }}" value="{{ v }}">
  {% endfor %}

  <button class="btn btn-success mt-2">
    üíæ Sauvegarder
  </button>
  <a class="btn btn-outline-secondary mt-2" href="{{ url_for('history') }}">
    Historique
  </a>
</form>

<div class="contract-card">
  <pre class="contract-content" id="contractText">{{ contract_text }}</pre>
</div>

<script>
document.getElementById('copyBtn').addEventListener('click', async () => {
  const text = document.getElementById('contractText').innerText;
  await navigator.clipboard.writeText(text);
  alert('Contrat copi√© !');
});
</script>


{% endblock %}
